<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Dijkstra Demonstrator</title>
</head>

<body>
  <script type="text/x-template" id="graph-viewer">
    <svg :width="width" :height="height">
      <svg-graph :graph="graph" />
    </svg>
  </script>

  <script type="text/x-template" id="svg-graph">
    <g>
      <svg-edge v-for="edge in graph.edges" :graph="graph" :edge="edge" />
      <svg-vertex v-for="(vertex, name) in graph.vertices" :key="name" :x="vertex.x" :y="vertex.y" :label="name" />
    </g>
  </script>

  <script type="text/x-template" id="svg-edge">
    <g :transform="transform">
        <line :x1="0" :x2="vLength.x" :y1="0" :y2="vLength.y" :stroke-width="width" :stroke="color" />
        <text fill="black" font-family="Arial" :x="vLength.x / 2" :y="vLength.y / 2" :dx="vWeightOffset.x" :dy="vWeightOffset.y" text-anchor="middle">{{ weight }}</text>
    </g>
  </script>

  <script type="text/x-template" id="svg-vertex">
    <g :transform="transform" >
      <circle r="20" stroke="black" stroke-width="2" fill="white" />
      <text fill="black" font-family="Arial" dy=".3em" text-anchor="middle" alignment-baseline="central">{{ label }}</text>
    </g>
  </script>



  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

  <div id="app">
    <graph-viewer width="300" height="300" :graph="graph" />
  </div>

  <script type="text/javascript">
    function default_graph() {
      return {
        directed: false,
        vertices: {
          "A": { x: 50, y: 50 },
          "B": { x: 200, y: 50 },
          "C": { x: 200, y: 200 }
        },
        edges: [
          { from: "A", to: "B", weight: 1, color: "orange", width: 6 },
          { from: "B", to: "C", weight: 2 },
          { from: "C", to: "A", weight: 3 }
        ]
      }
    }

    // Returns the property of an object that belongs to key, or defaultVal, if there is no such property in the object
    function propertyOrDefault(object, key, defaultVal) {
      return (object[key] == undefined) ? defaultVal : object[key];
    }

    Vue.component('svg-edge', {
      template: '#svg-edge',
      props: ["graph", "edge"],
      computed: {
        angle() { // Angle of the edge against the X axis
          var l = this.vLength
          return Math.atan(l.y / l.x)
        },
        color() {
          return propertyOrDefault(this.edge, "color", "black")
        },
        transform() {
          var p = this.vPosition
          return "translate(" + p.x + "," + p.y + ")";
        },
        vertexFrom() {
          return this.graph.vertices[this.edge["from"]]
        },
        vertexTo() {
          return this.graph.vertices[this.edge["to"]]
        },
        vLength() { // Length vector
          var from = this.vertexFrom
          var to = this.vertexTo
          return { x: to["x"]-from["x"], y: to["y"]-from["y"] }
        },
        vPosition() { // Position vector
          var from = this.vertexFrom
          return { x: from["x"], y: from["y"] }
        },
        vWeightOffset() {
          var offset = -10
          return { x: offset * Math.sin(-this.angle), y: offset * Math.cos(-this.angle) }
        },
        weight() {
          return propertyOrDefault(this.edge, "weight", 0)
        },
        width() {
          return propertyOrDefault(this.edge, "width", 2)
        }
      }
    })

    Vue.component('svg-vertex', {
      template: '#svg-vertex',
      props: ["x", "y", "label"],
      computed: {
        transform() {
          return "translate(" + this.x + "," + this.y + ")";
        }
      }
    })

    Vue.component('svg-graph', {
      template: '#svg-graph',
      mounted() {
        if (this.graph.directed != false)
          alert("Warning: Directed graphs are not yet supported!");
      },
      props: {
        graph: { type: Object, required: true }
      }
    })

    Vue.component('graph-viewer', {
      template: '#graph-viewer',
      props: {
        'width': { type: String, required: true },
        'height': { type: String, required: true },
        'graph': { type: Object, required: true }
      }
    })

    var app = new Vue({
      el: '#app',
      data() { return {
        graph: default_graph()
      } }
    })
  </script>

</body>
</html>
